<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Temporal documentation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.min.css">
    <script type="application/javascript" src="./playground.js"></script>
    <link rel="stylesheet" type="text/css" href="./prism.css">
    <script>
      Temporal = { ...temporal.Temporal };
      Object.assign(Intl, temporal.Intl);

      // Customize output of Temporal objects for Chrome DevTools
      if (!window.devtoolsFormatters)
        window.devtoolsFormatters = [];
      window.devtoolsFormatters.push({
        header(x) {
          for (const type of [
            Temporal.Instant,
            Temporal.Calendar,
            Temporal.Date,
            Temporal.DateTime,
            Temporal.Duration,
            Temporal.MonthDay,
            Temporal.Time,
            Temporal.TimeZone,
            Temporal.YearMonth
          ]) {
            if (x instanceof type) return ['span', {}, `${x[Symbol.toStringTag]} <${x}>`];
          }
          return null;
        },
        hasBody(x) {
          return x instanceof Temporal.Duration;
        },
        body(x) {
          const out = ['ol', { style: 'list-style-type: none;' }];
          for (const prop of [
            'years',
            'months',
            'weeks',
            'days',
            'hours',
            'minutes',
            'seconds',
            'milliseconds',
            'microseconds',
            'nanoseconds'
          ]) {
            if (x[prop] !== 0) out.push([
              'li',
              {},
              ['span', { style: 'color: purple;' }, prop],
              `: `,
              ['span', { style: 'color: blue;' }, x[prop]]
            ]);
          }
          return out;
        }
      });
    </script>
    <style>
      /* https://github.com/kognise/water.css/blob/master/src/variables-light.css */
      :root {
        --background: #efefef;
        --text-muted: #999999;
        --text-bright: #000000;
        --text-width: 900px;
        --variable: #39a33c;
      }
      body {
        font-size: 18px;
        max-width: var(--text-width);
        padding-top: 40px;  /* extra padding for banner */
        line-height: 1.5;
      }
      pre { border-left: 4px solid var(--variable); }
      code {
        padding: 1px 5px 2px 5px;
        line-height: 1.1;
        display: inline-block;
      }
      pre code { line-height: 1.4; }
      pre code[class*="language-"] { font-size: 0.85em; }
      pre[class*="language-"] { padding: 0.5em; }
      h1 { margin-top: 13px; }
      h2 { border-bottom: 2px solid var(--text-muted); margin-top: 2em; }
      h3 {
        border-bottom: 1px solid var(--text-muted);
        color: var(--text-muted);
        font-weight: normal;
      }
      h3 em { font-weight: bold; }
      h3 strong { color: var(--text-bright); }
      :not(h2) + h3 { margin-top: 2em; }
      footer {
        border-top: 1px solid var(--background);
        color: var(--text-muted);
        font-size: 0.8em;
        margin-top: 2em;
        padding-top: 10px;
      }
      .heading-link {
        left: calc((100vw - var(--text-width)) / 2 - 1.5em);
        opacity: 0;
        position: absolute;
        transition: opacity 150ms;
      }
      .heading-link:hover { text-decoration: none; }
      .heading-link::before { content: 'Â¶'; }
      h3:hover .heading-link { opacity: 1; }
      .banner {
        /* Gradient from https://joshnh.com/weblog/how-to-make-an-alert-bar/ */
        background-color: #fce94f;
        background-image: linear-gradient(135deg,
                                          transparent,
                                          transparent 25%,
                                          rgba(0, 0, 0, .05) 25%,
                                          rgba(0, 0, 0, .05) 50%,
                                          transparent 50%,
                                          transparent 75%,
                                          rgba(0, 0, 0, .05) 75%,
                                          rgba(0, 0, 0, .05));
        background-size: 20px 20px;
        box-shadow: 0 5px 0 rgba(0, 0, 0, .1);
        left: 0;
        padding: 0.4em 0;
        position: absolute;
        text-align: center;
        top: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="banner">
      This proposal is <strong><a href="https://blogs.igalia.com/compilers/2020/06/23/dates-and-times-in-javascript/">experimental.</a></strong>
      The API will change based on feedback that we get.
      <strong>Do</strong> <a href="https://forms.gle/iL9iZg7Y9LvH41Nv8">give feedback</a> and open <a href="https://github.com/tc39/proposal-temporal/issues">issues</a>; <strong>don't</strong> use it in production!
    </div>
<h1 id="duration-balancing">Duration balancing</h1>
<p>With most types in Temporal, each unit has a natural maximum.
For example, there is no such time as 11:87, so when creating a <code>Temporal.Time</code> from 11:87 the time is either clipped to 11:59 (&quot;constrain&quot; mode) or an exception is thrown (&quot;reject&quot; mode).</p>
<h2 id="constructing-a-duration">Constructing a duration</h2>
<p>With <a href="./duration.html"><code>Temporal.Duration</code></a>, however, maximums are less clear-cut.
Take, for example, a duration of 100 seconds: <code>Temporal.Duration.from({ seconds: 100 })</code>.
100 seconds is equal to 1 minute and 40 seconds. Instead of clipping this to 59 seconds it&#39;s more likely that we would want to &quot;balance&quot; it, wrapping 60 seconds around to 0 to make 1 minute and 40 seconds.
However, it&#39;s an equally valid use case to want to track the duration of something in seconds only, and not balance the duration to 1 minute and 40 seconds.</p>
<p>What is done with the duration depends on the <code>overflow</code> option when creating the <code>Temporal.Duration</code> object.
Unlike with the other Temporal types, constrain mode doesn&#39;t clip the seconds value to 59, and reject mode doesn&#39;t throw.
They just leave the value as it is.
Balance mode lets you opt in to the balancing behaviour:</p>
<pre class="language-javascript"><code class="language-javascript">d <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> seconds<span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
d<span class="token punctuation">.</span>minutes  <span class="token comment">// => 1</span>
d<span class="token punctuation">.</span>seconds  <span class="token comment">// => 40</span></code></pre><p>Balancing between the different units of durations excludes years and months, because years and months can have different lengths.
In the default ISO calendar, a year can be 365 or 366 days, and a month can be 28, 29, 30, or 31 days.
Therefore, any <code>Duration</code> object with nonzero years or months can refer to a different length of time depending on when the start date is.
No balancing is ever performed between years, months, and days, because such conversion would be ambiguous.
If you need such a conversion, you must implement it yourself, since the rules can depend on the start date and the calendar in use.</p>
<p><code>Temporal.Duration</code> fields are not allowed to have mixed signs.
For example, <code>Temporal.Duration.from({ hours: 1, minutes: -30 })</code> will always throw an exception, regardless of the overflow option.</p>
<p>Therefore, the only case where constrain and reject mode have any effect when creating a duration, is integer overflow.
If one of the values overflows, constrain mode will cap it to <code>Number.MAX_VALUE</code> or <code>-Number.MAX_VALUE</code>.</p>
<h2 id="duration-arithmetic">Duration arithmetic</h2>
<p>When adding two <code>Temporal.Duration</code>s of opposite sign, or subtracting two durations of the same sign, the situation is different.
As well as the same possibility of integer overflow, the fields may also need to be balanced.</p>
<p>Consider a duration of 90 minutes, from which is subtracted 30 seconds.
Subtracting the fields directly would result in 90 minutes and &minus;30 seconds, which is invalid.
Therefore, it&#39;s necessary to balance the seconds with the minutes, resulting in 89 minutes and 30 seconds.</p>
<p>By default, the fields of the resulting duration are only converted between each other if one unit is negative but a larger unit is positive, or vice versa, in which case the smaller is balanced with the larger to avoid having mixed-sign fields.</p>
<p>That&#39;s not all the balancing that <em>could</em> be done on the resulting value.
It could further be balanced into 1 hour, 29 minutes, and 30 seconds.
However, that would likely conflict with the intention of having a duration of 90 minutes in the first place, so this should be behaviour that the Temporal user opts in to.
Here, we make a distinction between &quot;necessary balancing&quot; and &quot;optional balancing&quot;.</p>
<p>In order to accommodate this, the <code>overflow</code> option when performing arithmetic on <code>Temporal.Duration</code>s is different from all the other arithmetic methods&#39; overflow options.
Necessary balancing is called <code>constrain</code> mode, because values are constrained to be non-negative through balancing.
Optional balancing is called <code>balance</code> mode.</p>
<p>The default is <code>constrain</code> mode.
The <code>balance</code> mode is only provided for convenience, since the following code snippets give the same result:</p>
<pre class="language-javascript"><code class="language-javascript">duration3 <span class="token operator">=</span> duration1<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>duration2<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

tmp <span class="token operator">=</span> duration1<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>duration2<span class="token punctuation">)</span><span class="token punctuation">;</span>
duration3 <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
duration3 <span class="token operator">=</span> tmp<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Here are some more examples of what each mode does:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Simple, no balancing possible</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// => PT2H</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => PT2H</span>

<span class="token comment">// Balancing possible but not necessary</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">180</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// => PT120M</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => PT2H</span>

<span class="token comment">// Some balancing necessary, more balancing possible</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> minutes<span class="token operator">:</span> <span class="token number">180</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> seconds<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// => PT179M30S</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => PT2H59M30S</span>

<span class="token comment">// Balancing necessary, result is positive</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> minutes<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> minutes<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// => PT1H45M</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => PT1H45M</span>

<span class="token comment">// Result is negative</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> minutes<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hours<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// -PT30M</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// -PT30M</span>

<span class="token comment">// Unbalanceable units, but also no balancing possible</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> months<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> days<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// => P3M5D</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// => P3M5D</span>

<span class="token comment">// Result is in theory positive in the ISO calendar, but unbalanceable units</span>
one <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> months<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> days<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
two <span class="token operator">=</span> Temporal<span class="token punctuation">.</span>Duration<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> days<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span>                           <span class="token comment">// throws</span>
one<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span>two<span class="token punctuation">,</span> <span class="token punctuation">{</span> overflow<span class="token operator">:</span> <span class="token string">'balance'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// throws</span></code></pre><h2 id="serialization">Serialization</h2>
<p>Normally, any Temporal object can be serialized to a string with its <code>toString()</code> method, and deserialized by calling <code>from()</code> on the string.
This goes for <code>Temporal.Duration</code> as well.
However, if any of the <code>milliseconds</code>, <code>microseconds</code>, or <code>nanoseconds</code> properties are greater than 999, then <code>Temporal.Duration.from(duration.toString())</code> will not yield an identical <code>Temporal.Duration</code> object.
The deserialized object will represent an equally long duration, but the sub-second fields will be balanced with the <code>seconds</code> field so that they become 999 or less.
For example, 1000 nanoseconds will become 1 microsecond.</p>
<p>This is because the ISO 8601 string format for durations, which is used for serialization for reasons of interoperability, does not allow for specifying sub-second units separately, only as a decimal fraction of seconds.
If you need to serialize a <code>Temporal.Duration</code> in a way that will preserve unbalanced sub-second fields, you will need to use a custom serialization format.</p>
    <footer>
      <p>
        This page includes a script which loads an implementation of Temporal in your browser.
        You can open a console in your browser's developer tools and try it out directly!
      </p>
      <p>View this or help contribute on <a href="https://github.com/tc39/proposal-temporal">GitHub</a>.</p>
    </footer>
  </body>
</html>
